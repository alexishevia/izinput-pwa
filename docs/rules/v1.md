# v1 Rules

## Objects (aka Models)

### Accounts

Accounts are the building block for IZ. All money in IZ is kept in accounts.

Accounts have the following fields:

| field name     | type          | description                      | example                                |
| -------------- | ------------- | -------------------------------- | -------------------------------------- |
| id             | string        | Unique identifier for the        | "f3528a13-6683-45eb-b48c-34157c95b9db" |
|                | non empty     | account.                         |                                        |
|                |               |                                  |                                        |
| name           | string        | Human-friendly name for the      | "Savings"                              |
|                | non empty     | account                          |                                        |
|                |               |                                  |                                        |
| type           | enum:         | Defines whether the money in the | "INTERNAL"                             |
|                | "INTERNAL"    | account is under the user's      |                                        |
|                | "EXTERNAL"    | possession or not.               |                                        |
|                |               |                                  |                                        |
| initialBalance | decimal       | Amount of money in the account   | 300                                    |
|                |               | before tracking transfers in IZ  |                                        |
|                |               | (only applies to "INTERNAL"      |                                        |
|                |               | accounts)                        |                                        |
|                |               |                                  |                                        |
| modifiedAt     | string        | Last date the account data was   | "2019-10-12T12:25:35.059Z"             |
|                | full ISO 8601 | modified. (create, update, and   |                                        |
|                | date in UTC   | delete count for "modifiedAt")   |                                        |
|                |               |                                  |                                        |
| active         | boolean       | inactive accounts do not show up |                                        |
|                |               | on dropdowns, graphs or reports. |                                        |

### Transfer

A transfer represents an exchange of money between two accounts.

A transfer has the following fields:

| field name   | type          | description                       | example                                |
| ------------ | ------------- | --------------------------------- | -------------------------------------- |
| id           | string        | Unique identifier for the         | "aa39da77-2ad2-43a8-ad01-2bb096db3186" |
|              | non empty     | transfer.                         |                                        |
|              |               |                                   |                                        |
| amount       | decimal       | The amount of money being         | 13.5                                   |
|              | bigger than 0 | transferred.                      |                                        |
|              |               |                                   |                                        |
| from         | string        | ID of the account where the money | "1dc149bc-7165-43f7-addf-5a4e2f02122c" |
|              | account ID    | is coming from.                   |                                        |
|              |               |                                   |                                        |
| to           | string        | ID of the account where the money | "49f4d831-feb2-498b-8079-1c5b61dc9301" |
|              | account ID    | is headed to.                     |                                        |
|              |               |                                   |                                        |
| description  | string        | Additional notes for the          | "Whole Foods Market"                   |
|              |               | transfer.                         |                                        |
|              |               |                                   |                                        |
| transferDate | string        | Date the transfer occured.        | "2019-10-12"                           |
|              | YYYY-MM-DD    |                                   |                                        |
|              |               |                                   |                                        |
| modifiedAt   | string        | Last date the transfer was        | "2019-10-12T12:25:35.059Z"             |
|              | full ISO 8601 | modified. (create, update, and    |                                        |
|              | date in UTC   | delete count for "modifiedAt")    |                                        |
|              |               |                                   |                                        |
| deleted      | boolean       | true if the transfer has been     | false                                  |
|              |               | deleted. false otherwise.         |                                        |

## Actions

Objects in the system can only be created/modified/deleted using the following actions:

### v1 accounts/create

Use this action to create a new account.

Example:

```
{
  "version": 1,
  "type": "accounts/create",
  "payload": {
    "id": "9bf1e1ce-a779-11ea-bb37-0242ac130002",
    "name": "Savings",
    "type": "INTERNAL",
    "initialBalance": 300,
    "modifiedAt": "2020-06-05T22:13:25.926Z",
    "active": true
  }
}
```

Rules:

1. IF the account `id` is unique (no other accounts with the same `id` exist)  
    AND all account fields are included in `payload`  
    AND all account field values have the correct type  
   THEN an account MUST be created using the `payload` values.

Notes:

1. While not required, it is recommended to use UUIDs for account ids.
   Using UUIDs diminishes the probability of an unwanted conflict.

### v1 accounts/update

Use this action to update an existing account.

Example:
(in this example I'm updating the initialBalance field for the account created above)

```
{
  "version": 1,
  "type": "accounts/update",
  "payload": {
    "id": "9bf1e1ce-a779-11ea-bb37-0242ac130002",
    "initialBalance": 120.50,
    "modifiedAt": "2020-06-05T22:16:42.565Z"
  }
}
```

Rules:

1. IF the account `id` is not unique (an account with the same `id` already exists)  
    AND a valid `payload.modifiedAt` value is included  
    AND `payload.modifiedAt` is later than the existing account's `modifiedAt`  
   THEN the data in `action.payload` must be merged with the existing account's data.  
    ie:  
    fields included in `action.payload` override the same fields in the existing account  
    fields in the existing account that are NOT included in `action.payload` remain unchanged

### v1 transfers/create

Use this action to create a transfer between two accounts.

Example:

```
{
  "version": 1,
  "type": "transfers/create",
  "payload": {
    "id": "aa39da77-2ad2-43a8-ad01-2bb096db3186",
    "from": "1dc149bc-7165-43f7-addf-5a4e2f02122c",
    "to": "49f4d831-feb2-498b-8079-1c5b61dc9301",
    "amount": 13.5,
    "description": "Whole Foods Market",
    "transferDate": "2019-10-12",
    "modifiedAt": "2019-10-12T12:25:35.059Z",
    "deleted": false
  }
}
```

Rules:

1. IF the transfer `id` is unique (no other transfers with the same `id` exist)  
    AND all transfer fields are included in `payload`  
    AND all transfer field values have the correct type  
    AND the `payload.from` account exists  
    AND the `payload.to` account exists  
    AND `payload.deleted` is `false`  
   THEN an transfer MUST be created using the `payload` values.

Notes:

1. While not required, it is recommended to use UUIDs for transfer ids.
   Using UUIDs diminishes the probability of an unwanted conflict.

### v1 transfers/update

Use this action to update a transfer

Note: to delete a transfer, use `transfers/delete` instead.

Example:
(in this example I'm updating the amount field for the transaction created above)

```
{
  "version": 1,
  "type": "transfers/create",
  "payload": {
    "id: "aa39da77-2ad2-43a8-ad01-2bb096db3186",
    "amount": 135,
    "modifiedAt": "2019-10-12T02:49:00.704Z"
  }
}
```

Rules:

1. IF the transfer `id` is not unique (another transfer with the same `id` already exists)  
    AND a valid `payload.modifiedAt` value is included  
    AND `payload.modifiedAt` is later than the existing transfer's `modifiedAt`  
    AND `payload.deleted` is NOT `false`  
   THEN the data in `action.payload` must be merged with the existing transfer's data.  
    ie:  
    fields included in `action.payload` override the same fields in the existing transfer  
    fields in the existing transfer that are NOT included in `action.payload` remain unchanged

### v1 transfers/delete

Use this action to delete an existing transfer.

Example:

```
{
  "version": 1,
  "type": "transfers/delete",
  "payload": {
    "id: "aa39da77-2ad2-43a8-ad01-2bb096db3186",
    "modifiedAt": "2020-06-05T22:16:42.565Z"
  }
}
```

Rules:

1. IF the transfer `id` is not unique (a transfer with the same `id` already exists)  
    AND a valid `payload.modifiedAt` value is included  
    AND `payload.modifiedAt` is later than the existing transfer's `modifiedAt`  
   THEN the transfer's `deleted` field must be set to `true`
   THEN the transfer's `modifiedAt` must be set to `payload.modifiedAt`
